import{_ as Y,u as ee,r as h,o as te,a as se,c as a,j as l,d as s,g as L,t as m,e as M,h as oe,q as re,F as U,f as A,n as N,i as S,b as ae}from"./index-XdPP88zw.js";import le from"./MonacoEditor-B0iY9Hov.js";import{f as ne,a as z}from"./ExampleLoader-C0CuCz3g.js";import"./monaco-editor-CGO6wXTd.js";const ie={class:"flex flex-col md:flex-row h-full"},de={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col border-b md:border-b-0 md:border-r border-slate-700"},ue={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-800/50"},ce={class:"flex items-center gap-4"},pe={class:"flex items-center gap-2"},me={key:0,class:"text-xs px-2 py-0.5 bg-emerald-600 text-white rounded-full"},fe={key:1,class:"text-xs px-2 py-0.5 bg-slate-600 text-slate-300 rounded-full"},he={class:"relative group"},ve=["label"],xe=["value"],ge=["disabled"],we={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_e={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},ye={class:"flex-1 min-h-0"},be={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-slate-900"},Me={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},ke={class:"flex items-center gap-3"},Fe={class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},Ce={key:0,class:"text-xs text-slate-500"},Ee={key:0,class:"flex-1 flex items-center justify-center"},Le={class:"text-center space-y-4"},Be={class:"text-slate-400"},je={key:1,class:"flex-1 overflow-y-auto p-4 font-mono text-sm space-y-1"},$e={key:0,class:"flex items-center gap-2 text-slate-400 italic animate-pulse"},Ue={key:0,class:"text-red-400"},Ae={key:1,class:"text-emerald-400"},Te={class:"whitespace-pre-wrap"},Ve={key:1,class:"text-slate-500 italic"},qe={__name:"FortranRunner",emits:["output","error","ready"],setup(Re,{emit:O}){const{t:g}=ee(),T=O,w=h(""),V=h(null),_=h(""),d=h([]),n=h(!1),k=h(!1),c=h(""),y=h(null);let B=null,j=null;const F=t=>typeof t!="string"?t:t.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""),P=async()=>{try{const t=await ne("fortran");if(V.value=t,t.chapters&&t.chapters.length>0&&t.chapters[0].examples.length>0){const e=t.chapters[0].examples[0];_.value=e.path,w.value=await z("fortran",e.path)}}catch(t){console.error("Failed to load Fortran manifest:",t)}},q=async()=>{if(!k.value){n.value=!0,c.value="Loading LFortran compiler...";try{const t="/tools/",e=`${t.endsWith("/")?t:t+"/"}fortran-wasm/`;window.Module={print:r=>{console.log("LFortran log:",r),d.value.push({type:"log",message:F(r)})},printErr:r=>{console.error("LFortran error:",r),d.value.push({type:"error",message:F(r)})},locateFile:r=>r.endsWith(".wasm")?`${e}lfortran.wasm`:r.endsWith(".data")?`${e}lfortran.data`:r,onRuntimeInitialized:()=>{try{B=window.Module.cwrap("emit_wasm_from_source","string",["string"]),k.value=!0,T("ready"),n.value=!1,c.value=""}catch(r){console.error("Failed to wrap LFortran functions:",r),d.value.push({type:"error",message:`Initialization error: ${r.message}`})}}},await new Promise((r,i)=>{const u=document.createElement("script");u.src=`${e}lfortran.js`,u.onload=r,u.onerror=()=>i(new Error("Failed to load lfortran.js")),document.head.appendChild(u)})}catch(t){d.value.push({type:"error",message:`Failed to load LFortran runtime: ${t.message}`}),console.error(t),n.value=!1,c.value=""}}},H=async()=>{if(k.value||await q(),!B){d.value.push({type:"error",message:"LFortran compiler not ready"});return}d.value=[],y.value=null,n.value=!0,c.value="Compiling...";try{const t=performance.now(),e=B(w.value),i=(performance.now()-t).toFixed(2);if(!e)throw new Error("Compilation failed: no response from compiler");const u=e.split(",");if(u[0]!=="0"){const o=u.slice(1);let p="";if(o.length>0&&o.every(x=>/^\d+$/.test(x.trim())))try{const x=new Uint8Array(o.map(Number));p=new TextDecoder().decode(x)}catch{p=o.join(",")}else p=o.join(",");throw new Error(`${F(p)}
Compilation Time: ${i} ms`)}const f=new Uint8Array(u.slice(1).map(Number));if(f.length<4||f[0]!==0&&f[0]!==0||f[1]!==97||f[2]!==115||f[3]!==109)throw console.error("Invalid WASM binary generated (magic word mismatch)",f.slice(0,8)),new Error("Invalid WASM binary generated by compiler");c.value="Executing...";let C="";const W=()=>{C&&(d.value.push({type:"log",message:F(C)}),C="")},J={wasi_snapshot_preview1:{fd_write:(o,p,v,x)=>{const $=new DataView(j.buffer);let D=0;for(let E=0;E<v;E++){const Q=$.getUint32(p+E*8,!0),I=$.getUint32(p+E*8+4,!0),X=new Uint8Array(j.buffer,Q,I);C+=new TextDecoder().decode(X),D+=I}return $.setUint32(x,D,!0),0},fd_close:()=>0,fd_seek:()=>0,proc_exit:o=>{if(W(),o!==0)throw new Error(`Exit with code ${o}`);console.log(`Program exited with code ${o}`)}},js:{cpu_time:()=>Date.now()/1e3,show_img:(o,p,v)=>{console.log("show_img",o,p,v)},show_img_color:(o,p,v)=>{console.log("show_img_color",o,p,v)},sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,atan2:Math.atan2,exp:Math.exp,log:Math.log,sqrt:Math.sqrt,abs:Math.abs,pow:Math.pow,_lfortran_ssin:Math.sin,_lfortran_sdsin:Math.sin,_lfortran_scos:Math.cos,_lfortran_sdcos:Math.cos,_lfortran_stex:Math.exp,_lfortran_sdexp:Math.exp,_lfortran_slon:Math.log,_lfortran_sdlog:Math.log,_lfortran_ssqrt:Math.sqrt,_lfortran_sdsqrt:Math.sqrt}},{instance:b}=await WebAssembly.instantiate(f,J);j=b.exports.memory;try{b.exports._start?b.exports._start():b.exports.main&&b.exports.main()}catch(o){if(o.message&&o.message.startsWith("Exit with code")){if(o.message!=="Exit with code 0")throw o}else throw o}const K=performance.now();y.value=(K-t).toFixed(2),W(),d.value.length===0&&d.value.push({type:"log",message:"Program finished with no output."})}catch(t){d.value.push({type:"error",message:t.message}),T("error",t)}finally{n.value=!1,c.value=""}},Z=async()=>{if(_.value){R();try{n.value=!0,c.value="Loading example...",w.value=await z("fortran",_.value)}catch(t){d.value.push({type:"error",message:`Failed to load example: ${t.message}`})}finally{n.value=!1,c.value=""}}},R=()=>{d.value=[],y.value=null},G=t=>t==="error"?"text-red-400":"text-emerald-400";return te(()=>{q(),P()}),se(()=>{window.Module&&delete window.Module}),(t,e)=>{var r;return l(),a("div",ie,[s("div",de,[s("div",ue,[s("div",ce,[s("div",pe,[e[2]||(e[2]=s("svg",{class:"w-5 h-5 text-purple-400",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z"})],-1)),e[3]||(e[3]=s("span",{class:"font-bold text-white"},"Fortran",-1)),k.value?(l(),a("span",me,m(M(g)("tools.code-playground.common.ready")),1)):n.value?L("",!0):(l(),a("span",fe,m(M(g)("tools.code-playground.common.not_loaded")),1))]),s("div",he,[oe(s("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i),onChange:Z,class:"appearance-none bg-slate-700/50 border border-slate-600 text-slate-200 text-xs rounded px-2 pr-6 py-1 hover:border-slate-500 focus:outline-none focus:ring-1 focus:ring-purple-500 transition-all cursor-pointer"},[(l(!0),a(U,null,A((r=V.value)==null?void 0:r.chapters,i=>(l(),a("optgroup",{key:i.title,label:i.title},[(l(!0),a(U,null,A(i.examples,u=>(l(),a("option",{key:u.path,value:u.path},m(u.name),9,xe))),128))],8,ve))),128))],544),[[re,_.value]]),e[4]||(e[4]=s("div",{class:"absolute inset-y-0 right-1.5 flex items-center pointer-events-none text-slate-400"},[s("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),s("button",{onClick:H,disabled:n.value,class:N(["px-4 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",n.value?"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500 text-white"])},[n.value?(l(),a("svg",we,[...e[5]||(e[5]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),a("svg",_e,[...e[6]||(e[6]=[s("path",{d:"M8 5v14l11-7z"},null,-1)])])),S(" "+m(n.value?"Loading...":M(g)("tools.code-playground.common.run")),1)],10,ge)]),s("div",ye,[ae(le,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=i=>w.value=i),language:"fortran",theme:"vs-dark",height:"100%",minimap:!1},null,8,["modelValue"])])]),s("div",be,[s("div",Me,[s("div",ke,[s("span",Fe,m(M(g)("tools.code-playground.common.output")),1),y.value?(l(),a("span",Ce,m(y.value)+"ms",1)):L("",!0)]),s("button",{onClick:R,class:"text-xs text-slate-500 hover:text-white transition-colors"},m(M(g)("tools.code-playground.common.clear")),1)]),n.value&&c.value!=="Executing..."&&c.value!=="Compiling..."?(l(),a("div",Ee,[s("div",Le,[e[7]||(e[7]=s("div",{class:"w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1)),s("div",Be,m(c.value),1),e[8]||(e[8]=s("div",{class:"text-xs text-slate-500"},"First load may take a few seconds...",-1))])])):(l(),a("div",je,[n.value?(l(),a("div",$e,[e[9]||(e[9]=s("div",{class:"w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"},null,-1)),S(" "+m(c.value),1)])):L("",!0),(l(!0),a(U,null,A(d.value,(i,u)=>(l(),a("div",{key:u,class:N(["flex items-start gap-2",G(i.type)])},[i.type==="error"?(l(),a("span",Ue,"✗")):(l(),a("span",Ae,"›")),s("span",Te,m(i.message),1)],2))),128)),d.value.length===0&&!n.value?(l(),a("div",Ve,' Click "Run" to execute Fortran code... ')):L("",!0)]))])])}}},ze=Y(qe,[["__scopeId","data-v-539e1efc"]]);export{ze as default};
