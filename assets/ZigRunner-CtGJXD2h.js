import{u as Ve,r as z,o as Fe,c as B,j as E,d as v,g as ae,t as I,e as K,h as Me,q as je,F as oe,f as le,n as Ue,i as Pe,b as We}from"./index-CxQpwng6.js";import He from"./MonacoEditor-BTPrw7R1.js";import{f as Ge,a as ke}from"./ExampleLoader-C0CuCz3g.js";import"./monaco-editor-DrHUTMTD.js";const fe=0,ue=1,m=0,h=8,re=20,G=28,Be=31,Ye=37,P=44,Ze=52,F=54,Ee=55,w=58,pe=63,Ae=76,ge=64;class J{static read_bytes(e,t){const s=new J;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){const f=[];for(let r=0;r<s;r++)f.push(J.read_bytes(e,t+8*r));return f}}class Q{static read_bytes(e,t){const s=new Q;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){const f=[];for(let r=0;r<s;r++)f.push(Q.read_bytes(e,t+8*r));return f}}const $e=0,qe=1,Ce=2,De=2,L=3,ne=4;class de{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(e,t){e.setBigUint64(t,this.d_next,!0),e.setBigUint64(t+8,this.d_ino,!0),e.setUint32(t+16,this.dir_name.length,!0),e.setUint8(t+20,this.d_type)}write_name_bytes(e,t,s){e.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,s)),t)}constructor(e,t,s,f){const r=new TextEncoder().encode(s);this.d_next=e,this.d_ino=t,this.d_namlen=r.byteLength,this.d_type=f,this.dir_name=r}}const Ke=1;class ye{write_bytes(e,t){e.setUint8(t,this.fs_filetype),e.setUint16(t+2,this.fs_flags,!0),e.setBigUint64(t+8,this.fs_rights_base,!0),e.setBigUint64(t+16,this.fs_rights_inherited,!0)}constructor(e,t){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=e,this.fs_flags=t}}const ce=1,X=2,Te=4,Le=8;class we{write_bytes(e,t){e.setBigUint64(t,this.dev,!0),e.setBigUint64(t+8,this.ino,!0),e.setUint8(t+16,this.filetype),e.setBigUint64(t+24,this.nlink,!0),e.setBigUint64(t+32,this.size,!0),e.setBigUint64(t+38,this.atim,!0),e.setBigUint64(t+46,this.mtim,!0),e.setBigUint64(t+52,this.ctim,!0)}constructor(e,t,s){this.dev=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.ino=e,this.filetype=t,this.size=s}}const Xe=0,Je=1;class be{static read_bytes(e,t){return new be(e.getBigUint64(t,!0),e.getUint8(t+8),e.getUint32(t+16,!0),e.getBigUint64(t+24,!0),e.getUint16(t+36,!0))}constructor(e,t,s,f,r){this.userdata=e,this.eventtype=t,this.clockid=s,this.timeout=f,this.flags=r}}class Qe{write_bytes(e,t){e.setBigUint64(t,this.userdata,!0),e.setUint16(t+8,this.error,!0),e.setUint8(t+10,this.eventtype)}constructor(e,t,s){this.userdata=e,this.error=t,this.eventtype=s}}const et=0;class tt{write_bytes(e,t){e.setUint32(t,this.pr_name.byteLength,!0)}constructor(e){this.pr_name=new TextEncoder().encode(e)}}class xe{static dir(e){const t=new xe;return t.tag=et,t.inner=new tt(e),t}write_bytes(e,t){e.setUint32(t,this.tag,!0),this.inner.write_bytes(e,t+4)}}let rt=class{enable(e){this.log=nt(e===void 0?!0:e,this.prefix)}get enabled(){return this.isEnabled}constructor(e){this.isEnabled=e,this.prefix="wasi:",this.enable(e)}};function nt(b,e){return b?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}const A=new rt(!1);class Ne extends Error{constructor(e){super("exit with exit code "+e),this.code=e}}let Re=class{start(e){this.inst=e;try{return e.exports._start(),0}catch(t){if(t instanceof Ne)return t.code;throw t}}initialize(e){this.inst=e,e.exports._initialize&&e.exports._initialize()}constructor(e,t,s,f={}){this.args=[],this.env=[],this.fds=[],A.enable(f.debug),this.args=e,this.env=t,this.fds=s;const r=this;this.wasiImport={args_sizes_get(n,i){const a=new DataView(r.inst.exports.memory.buffer);a.setUint32(n,r.args.length,!0);let o=0;for(const l of r.args)o+=l.length+1;return a.setUint32(i,o,!0),A.log(a.getUint32(n,!0),a.getUint32(i,!0)),0},args_get(n,i){const a=new DataView(r.inst.exports.memory.buffer),o=new Uint8Array(r.inst.exports.memory.buffer),l=i;for(let u=0;u<r.args.length;u++){a.setUint32(n,i,!0),n+=4;const _=new TextEncoder().encode(r.args[u]);o.set(_,i),a.setUint8(i+_.length,0),i+=_.length+1}return A.enabled&&A.log(new TextDecoder("utf-8").decode(o.slice(l,i))),0},environ_sizes_get(n,i){const a=new DataView(r.inst.exports.memory.buffer);a.setUint32(n,r.env.length,!0);let o=0;for(const l of r.env)o+=new TextEncoder().encode(l).length+1;return a.setUint32(i,o,!0),A.log(a.getUint32(n,!0),a.getUint32(i,!0)),0},environ_get(n,i){const a=new DataView(r.inst.exports.memory.buffer),o=new Uint8Array(r.inst.exports.memory.buffer),l=i;for(let u=0;u<r.env.length;u++){a.setUint32(n,i,!0),n+=4;const _=new TextEncoder().encode(r.env[u]);o.set(_,i),a.setUint8(i+_.length,0),i+=_.length+1}return A.enabled&&A.log(new TextDecoder("utf-8").decode(o.slice(l,i))),0},clock_res_get(n,i){let a;switch(n){case ue:{a=5000n;break}case fe:{a=1000000n;break}default:return Ze}return new DataView(r.inst.exports.memory.buffer).setBigUint64(i,a,!0),m},clock_time_get(n,i,a){const o=new DataView(r.inst.exports.memory.buffer);if(n===fe)o.setBigUint64(a,BigInt(new Date().getTime())*1000000n,!0);else if(n==ue){let l;try{l=BigInt(Math.round(performance.now()*1e6))}catch{l=0n}o.setBigUint64(a,l,!0)}else o.setBigUint64(a,0n,!0);return 0},fd_advise(n,i,a,o){return r.fds[n]!=null?m:h},fd_allocate(n,i,a){return r.fds[n]!=null?r.fds[n].fd_allocate(i,a):h},fd_close(n){if(r.fds[n]!=null){const i=r.fds[n].fd_close();return r.fds[n]=void 0,i}else return h},fd_datasync(n){return r.fds[n]!=null?r.fds[n].fd_sync():h},fd_fdstat_get(n,i){if(r.fds[n]!=null){const{ret:a,fdstat:o}=r.fds[n].fd_fdstat_get();return o!=null&&o.write_bytes(new DataView(r.inst.exports.memory.buffer),i),a}else return h},fd_fdstat_set_flags(n,i){return r.fds[n]!=null?r.fds[n].fd_fdstat_set_flags(i):h},fd_fdstat_set_rights(n,i,a){return r.fds[n]!=null?r.fds[n].fd_fdstat_set_rights(i,a):h},fd_filestat_get(n,i){if(r.fds[n]!=null){const{ret:a,filestat:o}=r.fds[n].fd_filestat_get();return o!=null&&o.write_bytes(new DataView(r.inst.exports.memory.buffer),i),a}else return h},fd_filestat_set_size(n,i){return r.fds[n]!=null?r.fds[n].fd_filestat_set_size(i):h},fd_filestat_set_times(n,i,a,o){return r.fds[n]!=null?r.fds[n].fd_filestat_set_times(i,a,o):h},fd_pread(n,i,a,o,l){const u=new DataView(r.inst.exports.memory.buffer),_=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const d=J.read_bytes_array(u,i,a);let p=0;for(const c of d){const{ret:g,data:U}=r.fds[n].fd_pread(c.buf_len,o);if(g!=m)return u.setUint32(l,p,!0),g;if(_.set(U,c.buf),p+=U.length,o+=BigInt(U.length),U.length!=c.buf_len)break}return u.setUint32(l,p,!0),m}else return h},fd_prestat_get(n,i){const a=new DataView(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const{ret:o,prestat:l}=r.fds[n].fd_prestat_get();return l!=null&&l.write_bytes(a,i),o}else return h},fd_prestat_dir_name(n,i,a){if(r.fds[n]!=null){const{ret:o,prestat:l}=r.fds[n].fd_prestat_get();if(l==null)return o;const u=l.inner.pr_name;return new Uint8Array(r.inst.exports.memory.buffer).set(u.slice(0,a),i),u.byteLength>a?Ye:m}else return h},fd_pwrite(n,i,a,o,l){const u=new DataView(r.inst.exports.memory.buffer),_=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const d=Q.read_bytes_array(u,i,a);let p=0;for(const c of d){const g=_.slice(c.buf,c.buf+c.buf_len),{ret:U,nwritten:O}=r.fds[n].fd_pwrite(g,o);if(U!=m)return u.setUint32(l,p,!0),U;if(p+=O,o+=BigInt(O),O!=g.byteLength)break}return u.setUint32(l,p,!0),m}else return h},fd_read(n,i,a,o){const l=new DataView(r.inst.exports.memory.buffer),u=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const _=J.read_bytes_array(l,i,a);let d=0;for(const p of _){const{ret:c,data:g}=r.fds[n].fd_read(p.buf_len);if(c!=m)return l.setUint32(o,d,!0),c;if(u.set(g,p.buf),d+=g.length,g.length!=p.buf_len)break}return l.setUint32(o,d,!0),m}else return h},fd_readdir(n,i,a,o,l){const u=new DataView(r.inst.exports.memory.buffer),_=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){let d=0;for(;;){const{ret:p,dirent:c}=r.fds[n].fd_readdir_single(o);if(p!=0)return u.setUint32(l,d,!0),p;if(c==null)break;if(a-d<c.head_length()){d=a;break}const g=new ArrayBuffer(c.head_length());if(c.write_head_bytes(new DataView(g),0),_.set(new Uint8Array(g).slice(0,Math.min(g.byteLength,a-d)),i),i+=c.head_length(),d+=c.head_length(),a-d<c.name_length()){d=a;break}c.write_name_bytes(_,i,a-d),i+=c.name_length(),d+=c.name_length(),o=c.d_next}return u.setUint32(l,d,!0),0}else return h},fd_renumber(n,i){if(r.fds[n]!=null&&r.fds[i]!=null){const a=r.fds[i].fd_close();return a!=0?a:(r.fds[i]=r.fds[n],r.fds[n]=void 0,0)}else return h},fd_seek(n,i,a,o){const l=new DataView(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const{ret:u,offset:_}=r.fds[n].fd_seek(i,a);return l.setBigInt64(o,_,!0),u}else return h},fd_sync(n){return r.fds[n]!=null?r.fds[n].fd_sync():h},fd_tell(n,i){const a=new DataView(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const{ret:o,offset:l}=r.fds[n].fd_tell();return a.setBigUint64(i,l,!0),o}else return h},fd_write(n,i,a,o){const l=new DataView(r.inst.exports.memory.buffer),u=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const _=Q.read_bytes_array(l,i,a);let d=0;for(const p of _){const c=u.slice(p.buf,p.buf+p.buf_len),{ret:g,nwritten:U}=r.fds[n].fd_write(c);if(g!=m)return l.setUint32(o,d,!0),g;if(d+=U,U!=c.byteLength)break}return l.setUint32(o,d,!0),m}else return h},path_create_directory(n,i,a){const o=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const l=new TextDecoder("utf-8").decode(o.slice(i,i+a));return r.fds[n].path_create_directory(l)}else return h},path_filestat_get(n,i,a,o,l){const u=new DataView(r.inst.exports.memory.buffer),_=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const d=new TextDecoder("utf-8").decode(_.slice(a,a+o)),{ret:p,filestat:c}=r.fds[n].path_filestat_get(i,d);return c!=null&&c.write_bytes(u,l),p}else return h},path_filestat_set_times(n,i,a,o,l,u,_){const d=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const p=new TextDecoder("utf-8").decode(d.slice(a,a+o));return r.fds[n].path_filestat_set_times(i,p,l,u,_)}else return h},path_link(n,i,a,o,l,u,_){const d=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null&&r.fds[l]!=null){const p=new TextDecoder("utf-8").decode(d.slice(a,a+o)),c=new TextDecoder("utf-8").decode(d.slice(u,u+_)),{ret:g,inode_obj:U}=r.fds[n].path_lookup(p,i);return U==null?g:r.fds[l].path_link(c,U,!1)}else return h},path_open(n,i,a,o,l,u,_,d,p){const c=new DataView(r.inst.exports.memory.buffer),g=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const U=new TextDecoder("utf-8").decode(g.slice(a,a+o));A.log(U);const{ret:O,fd_obj:ee}=r.fds[n].path_open(i,U,l,u,_,d);if(O!=0)return O;r.fds.push(ee);const se=r.fds.length-1;return c.setUint32(p,se,!0),0}else return h},path_readlink(n,i,a,o,l,u){const _=new DataView(r.inst.exports.memory.buffer),d=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const p=new TextDecoder("utf-8").decode(d.slice(i,i+a));A.log(p);const{ret:c,data:g}=r.fds[n].path_readlink(p);if(g!=null){const U=new TextEncoder().encode(g);if(U.length>l)return _.setUint32(u,0,!0),h;d.set(U,o),_.setUint32(u,U.length,!0)}return c}else return h},path_remove_directory(n,i,a){const o=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const l=new TextDecoder("utf-8").decode(o.slice(i,i+a));return r.fds[n].path_remove_directory(l)}else return h},path_rename(n,i,a,o,l,u){const _=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null&&r.fds[o]!=null){const d=new TextDecoder("utf-8").decode(_.slice(i,i+a)),p=new TextDecoder("utf-8").decode(_.slice(l,l+u));let{ret:c,inode_obj:g}=r.fds[n].path_unlink(d);if(g==null)return c;if(c=r.fds[o].path_link(p,g,!0),c!=m&&r.fds[n].path_link(d,g,!0)!=m)throw"path_link should always return success when relinking an inode back to the original place";return c}else return h},path_symlink(n,i,a,o,l){const u=new Uint8Array(r.inst.exports.memory.buffer);return r.fds[a]!=null?(new TextDecoder("utf-8").decode(u.slice(n,n+i)),new TextDecoder("utf-8").decode(u.slice(o,o+l)),w):h},path_unlink_file(n,i,a){const o=new Uint8Array(r.inst.exports.memory.buffer);if(r.fds[n]!=null){const l=new TextDecoder("utf-8").decode(o.slice(i,i+a));return r.fds[n].path_unlink_file(l)}else return h},poll_oneoff(n,i,a){if(a===0)return G;if(a>1)return A.log("poll_oneoff: only a single subscription is supported"),w;const o=new DataView(r.inst.exports.memory.buffer),l=be.read_bytes(o,n),u=l.eventtype,_=l.clockid,d=l.timeout;if(u!==Xe)return A.log("poll_oneoff: only clock subscriptions are supported"),w;let p;if(_===ue)p=()=>BigInt(Math.round(performance.now()*1e6));else if(_===fe)p=()=>BigInt(new Date().getTime())*1000000n;else return G;const c=(l.flags&Je)!==0?d:p()+d;for(;c>p(););return new Qe(l.userdata,m,u).write_bytes(o,i),m},proc_exit(n){throw new Ne(n)},proc_raise(n){throw"raised signal "+n},sched_yield(){},random_get(n,i){const a=new Uint8Array(r.inst.exports.memory.buffer).subarray(n,n+i);if("crypto"in globalThis&&(typeof SharedArrayBuffer>"u"||!(r.inst.exports.memory.buffer instanceof SharedArrayBuffer)))for(let o=0;o<i;o+=65536)crypto.getRandomValues(a.subarray(o,o+65536));else for(let o=0;o<i;o++)a[o]=Math.random()*256|0},sock_recv(n,i,a){throw"sockets not supported"},sock_send(n,i,a){throw"sockets not supported"},sock_shutdown(n,i){throw"sockets not supported"},sock_accept(n,i){throw"sockets not supported"}}}};class ve{fd_allocate(e,t){return w}fd_close(){return 0}fd_fdstat_get(){return{ret:w,fdstat:null}}fd_fdstat_set_flags(e){return w}fd_fdstat_set_rights(e,t){return w}fd_filestat_get(){return{ret:w,filestat:null}}fd_filestat_set_size(e){return w}fd_filestat_set_times(e,t,s){return w}fd_pread(e,t){return{ret:w,data:new Uint8Array}}fd_prestat_get(){return{ret:w,prestat:null}}fd_pwrite(e,t){return{ret:w,nwritten:0}}fd_read(e){return{ret:w,data:new Uint8Array}}fd_readdir_single(e){return{ret:w,dirent:null}}fd_seek(e,t){return{ret:w,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:w,offset:0n}}fd_write(e){return{ret:w,nwritten:0}}path_create_directory(e){return w}path_filestat_get(e,t){return{ret:w,filestat:null}}path_filestat_set_times(e,t,s,f,r){return w}path_link(e,t,s){return w}path_unlink(e){return{ret:w,inode_obj:null}}path_lookup(e,t){return{ret:w,inode_obj:null}}path_open(e,t,s,f,r,n){return{ret:F,fd_obj:null}}path_readlink(e){return{ret:w,data:null}}path_remove_directory(e){return w}path_rename(e,t,s){return w}path_unlink_file(e){return w}}class M{static issue_ino(){return M.next_ino++}static root_ino(){return 0n}constructor(){this.ino=M.issue_ino()}}M.next_ino=1n;class me extends ve{fd_allocate(e,t){if(!(this.file.size>e+t)){const s=new Uint8Array(Number(e+t));s.set(this.file.data,0),this.file.data=s}return m}fd_fdstat_get(){return{ret:0,fdstat:new ye(ne,0)}}fd_filestat_set_size(e){if(this.file.size>e)this.file.data=new Uint8Array(this.file.data.buffer.slice(0,Number(e)));else{const t=new Uint8Array(Number(e));t.set(this.file.data,0),this.file.data=t}return m}fd_read(e){const t=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(e)));return this.file_pos+=BigInt(t.length),{ret:0,data:t}}fd_pread(e,t){return{ret:0,data:this.file.data.slice(Number(t),Number(t+BigInt(e)))}}fd_seek(e,t){let s;switch(t){case $e:s=e;break;case qe:s=this.file_pos+e;break;case Ce:s=BigInt(this.file.data.byteLength)+e;break;default:return{ret:G,offset:0n}}return s<0?{ret:G,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(e){if(this.file.readonly)return{ret:h,nwritten:0};if(this.file_pos+BigInt(e.byteLength)>this.file.size){const t=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(e.byteLength))),this.file.data.set(t)}return this.file.data.set(e,Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),{ret:0,nwritten:e.byteLength}}fd_pwrite(e,t){if(this.file.readonly)return{ret:h,nwritten:0};if(t+BigInt(e.byteLength)>this.file.size){const s=this.file.data;this.file.data=new Uint8Array(Number(t+BigInt(e.byteLength))),this.file.data.set(s)}return this.file.data.set(e,Number(t)),{ret:0,nwritten:e.byteLength}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(e){super(),this.file_pos=0n,this.file=e}}class Oe extends ve{fd_seek(e,t){return{ret:h,offset:0n}}fd_tell(){return{ret:h,offset:0n}}fd_allocate(e,t){return h}fd_fdstat_get(){return{ret:0,fdstat:new ye(L,0)}}fd_readdir_single(e){if(A.enabled&&(A.log("readdir_single",e),A.log(e,this.dir.contents.keys())),e==0n)return{ret:m,dirent:new de(1n,this.dir.ino,".",L)};if(e==1n)return{ret:m,dirent:new de(2n,this.dir.parent_ino(),"..",L)};if(e>=BigInt(this.dir.contents.size)+2n)return{ret:0,dirent:null};const[t,s]=Array.from(this.dir.contents.entries())[Number(e-2n)];return{ret:0,dirent:new de(e+1n,s.ino,t,s.stat().filetype)}}path_filestat_get(e,t){const{ret:s,path:f}=V.from(t);if(f==null)return{ret:s,filestat:null};const{ret:r,entry:n}=this.dir.get_entry_for_path(f);return n==null?{ret:r,filestat:null}:{ret:0,filestat:n.stat()}}path_lookup(e,t){const{ret:s,path:f}=V.from(e);if(f==null)return{ret:s,inode_obj:null};const{ret:r,entry:n}=this.dir.get_entry_for_path(f);return n==null?{ret:r,inode_obj:null}:{ret:m,inode_obj:n}}path_open(e,t,s,f,r,n){const{ret:i,path:a}=V.from(t);if(a==null)return{ret:i,fd_obj:null};let{ret:o,entry:l}=this.dir.get_entry_for_path(a);if(l==null){if(o!=P)return{ret:o,fd_obj:null};if((s&ce)==ce){const{ret:u,entry:_}=this.dir.create_entry_for_path(t,(s&X)==X);if(_==null)return{ret:u,fd_obj:null};l=_}else return{ret:P,fd_obj:null}}else if((s&Te)==Te)return{ret:re,fd_obj:null};return(s&X)==X&&l.stat().filetype!==L?{ret:F,fd_obj:null}:l.path_open(s,f,n)}path_create_directory(e){return this.path_open(0,e,ce|X,0n,0n,0).ret}path_link(e,t,s){const{ret:f,path:r}=V.from(e);if(r==null)return f;if(r.is_dir)return P;const{ret:n,parent_entry:i,filename:a,entry:o}=this.dir.get_parent_dir_and_entry_for_path(r,!0);if(i==null||a==null)return n;if(o!=null){const l=t.stat().filetype==L,u=o.stat().filetype==L;if(l&&u)if(s&&o instanceof C){if(o.contents.size!=0)return Ee}else return re;else{if(l&&!u)return F;if(!l&&u)return Be;if(!(t.stat().filetype==ne&&o.stat().filetype==ne))return re}}return!s&&t.stat().filetype==L?pe:(i.contents.set(a,t),m)}path_unlink(e){const{ret:t,path:s}=V.from(e);if(s==null)return{ret:t,inode_obj:null};const{ret:f,parent_entry:r,filename:n,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!0);return r==null||n==null?{ret:f,inode_obj:null}:i==null?{ret:P,inode_obj:null}:(r.contents.delete(n),{ret:m,inode_obj:i})}path_unlink_file(e){const{ret:t,path:s}=V.from(e);if(s==null)return t;const{ret:f,parent_entry:r,filename:n,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!1);return r==null||n==null||i==null?f:i.stat().filetype===L?Be:(r.contents.delete(n),m)}path_remove_directory(e){const{ret:t,path:s}=V.from(e);if(s==null)return t;const{ret:f,parent_entry:r,filename:n,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!1);return r==null||n==null||i==null?f:!(i instanceof C)||i.stat().filetype!==L?F:i.contents.size!==0?Ee:r.contents.delete(n)?m:P}fd_filestat_get(){return{ret:0,filestat:this.dir.stat()}}fd_filestat_set_size(e){return h}fd_read(e){return{ret:h,data:new Uint8Array}}fd_pread(e,t){return{ret:h,data:new Uint8Array}}fd_write(e){return{ret:h,nwritten:0}}fd_pwrite(e,t){return{ret:h,nwritten:0}}constructor(e){super(),this.dir=e}}class te extends Oe{fd_prestat_get(){return{ret:0,prestat:xe.dir(this.prestat_name)}}constructor(e,t){super(new C(t)),this.prestat_name=e}}class W extends M{path_open(e,t,s){if(this.readonly&&(t&BigInt(ge))==BigInt(ge))return{ret:pe,fd_obj:null};if((e&Le)==Le){if(this.readonly)return{ret:pe,fd_obj:null};this.data=new Uint8Array([])}const f=new me(this);return s&Ke&&f.fd_seek(0n,Ce),{ret:m,fd_obj:f}}get size(){return BigInt(this.data.byteLength)}stat(){return new we(this.ino,ne,this.size)}constructor(e,t){super(),this.data=new Uint8Array(e),this.readonly=!!(t!=null&&t.readonly)}}let V=class Se{static from(e){const t=new Se;if(t.is_dir=e.endsWith("/"),e.startsWith("/"))return{ret:Ae,path:null};if(e.includes("\0"))return{ret:G,path:null};for(const s of e.split("/"))if(!(s===""||s===".")){if(s===".."){if(t.parts.pop()==null)return{ret:Ae,path:null};continue}t.parts.push(s)}return{ret:m,path:t}}to_path_string(){let e=this.parts.join("/");return this.is_dir&&(e+="/"),e}constructor(){this.parts=[],this.is_dir=!1}};class C extends M{parent_ino(){return this.parent==null?M.root_ino():this.parent.ino}path_open(e,t,s){return{ret:m,fd_obj:new Oe(this)}}stat(){return new we(this.ino,L,0n)}get_entry_for_path(e){let t=this;for(const s of e.parts){if(!(t instanceof C))return{ret:F,entry:null};const f=t.contents.get(s);if(f!==void 0)t=f;else return A.log(s),{ret:P,entry:null}}return e.is_dir&&t.stat().filetype!=L?{ret:F,entry:null}:{ret:m,entry:t}}get_parent_dir_and_entry_for_path(e,t){const s=e.parts.pop();if(s===void 0)return{ret:G,parent_entry:null,filename:null,entry:null};const{ret:f,entry:r}=this.get_entry_for_path(e);if(r==null)return{ret:f,parent_entry:null,filename:null,entry:null};if(!(r instanceof C))return{ret:F,parent_entry:null,filename:null,entry:null};const n=r.contents.get(s);return n===void 0?t?{ret:m,parent_entry:r,filename:s,entry:null}:{ret:P,parent_entry:null,filename:null,entry:null}:e.is_dir&&n.stat().filetype!=L?{ret:F,parent_entry:null,filename:null,entry:null}:{ret:m,parent_entry:r,filename:s,entry:n}}create_entry_for_path(e,t){const{ret:s,path:f}=V.from(e);if(f==null)return{ret:s,entry:null};let{ret:r,parent_entry:n,filename:i,entry:a}=this.get_parent_dir_and_entry_for_path(f,!0);if(n==null||i==null)return{ret:r,entry:null};if(a!=null)return{ret:re,entry:null};A.log("create",f);let o;return t?o=new C(new Map):o=new W(new ArrayBuffer(0)),n.contents.set(i,o),a=o,{ret:m,entry:a}}constructor(e){super(),this.parent=null,e instanceof Array?this.contents=new Map(e):this.contents=e;for(const t of this.contents.values())t instanceof C&&(t.parent=this)}}class H extends ve{fd_filestat_get(){return{ret:0,filestat:new we(this.ino,De,BigInt(0))}}fd_fdstat_get(){const e=new ye(De,0);return e.fs_rights_base=BigInt(ge),{ret:0,fdstat:e}}fd_write(e){return this.write(e),{ret:0,nwritten:e.byteLength}}static lineBuffered(e){const t=new TextDecoder("utf-8",{fatal:!1});let s="";return new H(f=>{s+=t.decode(f,{stream:!0});const r=s.split(`
`);for(const[n,i]of r.entries())n<r.length-1?e(i):s=i})}constructor(e){super(),this.ino=M.issue_ino(),this.write=e}}var _e={},he,ze;function st(){if(ze)return he;ze=1;const b=function(e,t,s){var f=t||0,r=s||e.byteLength;this.bytes=new Uint8Array(e,f,r),this.ptr=0};return b.prototype.peekNumber=function(e){if(e<=0||typeof e!="number")return-1;for(var t=0,s=this.ptr+e-1;s>=this.ptr;)t<<=8,t|=this.bytes[s],--s;return t},b.prototype.readNumber=function(e){var t=this.peekNumber(e);return this.ptr+=e,t},b.prototype.peekSignedNumber=function(e){var t=this.peekNumber(e),s=Math.pow(2,e*8-1),f=s*2;return t>=s&&(t-=f),t},b.prototype.readSignedNumber=function(e){var t=this.peekSignedNumber(e);return this.ptr+=e,t},b.prototype.peekBytes=function(e,t){if(e<=0||typeof e!="number")return null;var s=this.bytes.subarray(this.ptr,this.ptr+e);return t&&(this.ptr+=e),s},b.prototype.readBytes=function(e){return this.peekBytes(e,!0)},b.prototype.peekString=function(e){if(e<=0||typeof e!="number")return"";for(var t="",s=this.ptr,f=this.ptr+e;s<f;++s)t+=String.fromCharCode(this.bytes[s]);return t},b.prototype.readString=function(e){var t=this.peekString(e);return this.ptr+=e,t},he=b,he}var Ie;function it(){if(Ie)return _e;Ie=1;const b=st(),e=function(s,f){const r=s.readString(f),n=r.indexOf("\0");return n!=-1?r.substring(0,n):r};function t(s){this.isValid=!1,this.name=e(s,100),this.mode=e(s,8),this.uid=e(s,8),this.gid=e(s,8),this.size=parseInt(e(s,12),8),this.mtime=e(s,12),this.chksum=e(s,8),this.typeflag=e(s,1),this.linkname=e(s,100),this.maybeMagic=e(s,6),this.maybeMagic=="ustar"?(this.version=e(s,2),this.uname=e(s,32),this.gname=e(s,32),this.devmajor=e(s,8),this.devminor=e(s,8),this.prefix=e(s,155),this.prefix.length&&(this.name=this.prefix+"/"+this.name),s.readBytes(12)):s.readBytes(249),this.filename=this.name,this.fileData=null,+this.typeflag==0&&(this.fileData=new Uint8Array(s.bytes.buffer,s.ptr,this.size),this.name.length>0&&this.fileData&&this.fileData.buffer&&(this.isValid=!0)),s.ptr+=this.size;const f=512-s.ptr%512;f>0&&f<512&&s.readBytes(f)}return _e.untar=function(s){const f=new b(s),r=[];for(;f.peekNumber(4)!=0;){const n=new t(f);n&&n.isValid&&r.push(n)}return r},_e}var at=it();const ot={class:"flex flex-col md:flex-row h-full"},lt={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col border-b md:border-b-0 md:border-r border-slate-700"},ft={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-800/50"},ut={class:"flex items-center gap-4"},dt={class:"flex items-center gap-2"},ct={key:0,class:"text-xs px-2 py-0.5 bg-emerald-600 text-white rounded-full"},_t={key:1,class:"text-xs px-2 py-0.5 bg-slate-600 text-slate-300 rounded-full"},ht={class:"relative group"},pt=["label"],gt=["value"],mt=["disabled"],yt={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wt={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},bt={class:"flex-1 min-h-0"},xt={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-slate-900"},vt={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},Ut={class:"flex items-center gap-3"},kt={class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},Bt={key:0,class:"text-xs text-slate-500"},Et={key:0,class:"flex-1 flex items-center justify-center"},At={class:"text-center space-y-4"},Dt={class:"text-slate-400"},Tt={key:1,class:"flex-1 overflow-y-auto p-4 font-mono text-sm space-y-1"},Lt={key:0,class:"text-red-400"},Nt={key:1,class:"text-emerald-400"},Rt={class:"whitespace-pre-wrap"},zt={key:0,class:"text-slate-500 italic"},Mt={__name:"ZigRunner",emits:["ready"],setup(b,{emit:e}){const{t}=Ve(),s=z(""),f=z(""),r=z(null),n=z([]),i=z(!1),a=z(!1),o=z(!1),l=z(""),u=z(null),_=async()=>{try{const x=await Ge("zig");if(r.value=x,x.chapters&&x.chapters.length>0&&x.chapters[0].examples.length>0){const y=x.chapters[0].examples[0];f.value=y.path,s.value=await ke("zig",y.path)}}catch(x){console.error("Failed to load Zig manifest:",x)}};let d=null,p=null;function c(x){return new C(new Map([...x.entries()].map(([y,D])=>D instanceof Map?[y,c(D)]:[y,new W(D)])))}const g=async()=>{if(!o.value){i.value=!0,n.value=[];try{const x="/tools/",y=`${x.endsWith("/")?x:x+"/"}zig-wasm/`;l.value="Loading Zig Compiler...";const D=await fetch(`${y}zig.wasm`);if(!D.ok)throw new Error(`Failed to fetch zig.wasm: ${D.statusText}`);d=await D.arrayBuffer(),l.value="Loading Standard Library...";const k=await fetch(`${y}zig.tar.gz`);if(!k.ok)throw new Error(`Failed to fetch zig.tar.gz: ${k.statusText}`);let T=await k.arrayBuffer();l.value="Extracting Standard Library...";const Y=new Uint8Array(T).slice(0,2);if(Y[0]===31&&Y[1]===139){const S=new DecompressionStream("gzip"),R=new Response(T).body.pipeThrough(S);T=await new Response(R).arrayBuffer()}const ie=at.untar(T),Z=new Map;for(const S of ie){let R=S.filename;if(R.startsWith("zig-out/lib/")&&(R=R.slice(8)),!R.startsWith("lib/"))continue;const $=R.slice(4);if(!$)continue;const q=$.split("/");let j=Z;for(const N of q.slice(0,-1))j.has(N)||j.set(N,new Map),j=j.get(N);j.set(q[q.length-1],S.fileData)}p=c(Z),o.value=!0,l.value=""}catch(x){console.error("Zig load failed",x),n.value.push({type:"error",message:"Failed to load Zig runtime: "+x.message})}finally{i.value=!1}}},U=async()=>{if(o.value||await g(),!(!d||!p)){a.value=!0,n.value=[],u.value=null;try{const x=performance.now(),y=new Map;y.set("main.zig",new W(new TextEncoder().encode(s.value)));const D=[new me(new W([])),H.lineBuffered(N=>n.value.push({type:"log",message:N})),H.lineBuffered(N=>n.value.push({type:"error",message:N})),new te(".",y),new te("/lib",p.contents),new te("/cache",new Map)],k=["zig.wasm","build-exe","main.zig","-fno-llvm","-fno-lld","-fno-ubsan-rt","-fno-entry"],T=[],Y=new Re(k,T,D,{debug:!1}),{instance:ie}=await WebAssembly.instantiate(d,{wasi_snapshot_preview1:Y.wasiImport}),Z=Y.start(ie);if(Z!==0)throw new Error(`Compilation failed (Exit Code: ${Z})`);const S=y.get("main.wasm");if(!S||!(S instanceof W))throw new Error("Compilation successful but 'main.wasm' not found.");n.value.push({type:"log",message:"Compilation successful. Running..."});const R=[new me(new W([])),H.lineBuffered(N=>n.value.push({type:"log",message:N})),H.lineBuffered(N=>n.value.push({type:"error",message:N})),new te(".",new Map)],$=new Re(["main.wasm"],[],R,{debug:!1}),{instance:q}=await WebAssembly.instantiate(S.data,{wasi_snapshot_preview1:$.wasiImport});$.start(q);const j=performance.now();u.value=(j-x).toFixed(2)}catch(x){n.value.push({type:"error",message:x.message}),console.error(x)}finally{a.value=!1}}},O=async()=>{if(f.value){ee();try{i.value=!0,l.value="Loading example...",s.value=await ke("zig",f.value)}catch(x){n.value.push({type:"error",message:`Failed to load example: ${x.message}`})}finally{i.value=!1,l.value=""}}},ee=()=>{n.value=[],u.value=null},se=x=>x==="error"?"text-red-400":"text-emerald-400";return Fe(()=>{g(),_()}),(x,y)=>{var D;return E(),B("div",ot,[v("div",lt,[v("div",ft,[v("div",ut,[v("div",dt,[y[2]||(y[2]=v("svg",{class:"w-5 h-5 text-orange-400",viewBox:"0 0 128 128",fill:"currentColor"},[v("path",{d:"M12.94 13.916 2.08 26.657h111.45L128 13.916H12.94zm-1.89 12.74L0 39.398l112.52.09L124.96 26.657H11.05zm-.1 38.648-9.98 12.74 125.86.095L115.82 65.304H10.95zm-1.63 12.74L0 90.785l114.73.09 11.23-12.83H9.32zm9.15 12.74L7.54 116.265h111.45l1.43-12.74H18.47z"})],-1)),y[3]||(y[3]=v("span",{class:"font-bold text-white"},"Zig",-1)),o.value?(E(),B("span",ct,I(K(t)("tools.code-playground.common.ready")),1)):i.value?ae("",!0):(E(),B("span",_t,I(K(t)("tools.code-playground.common.not_loaded")),1))]),v("div",ht,[Me(v("select",{"onUpdate:modelValue":y[0]||(y[0]=k=>f.value=k),onChange:O,class:"appearance-none bg-slate-700/50 border border-slate-600 text-slate-200 text-xs rounded px-2 pr-6 py-1 hover:border-slate-500 focus:outline-none focus:ring-1 focus:ring-orange-500 transition-all cursor-pointer"},[(E(!0),B(oe,null,le((D=r.value)==null?void 0:D.chapters,k=>(E(),B("optgroup",{key:k.title,label:k.title},[(E(!0),B(oe,null,le(k.examples,T=>(E(),B("option",{key:T.path,value:T.path},I(T.name),9,gt))),128))],8,pt))),128))],544),[[je,f.value]]),y[4]||(y[4]=v("div",{class:"absolute inset-y-0 right-1.5 flex items-center pointer-events-none text-slate-400"},[v("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),v("button",{onClick:U,disabled:i.value||a.value,class:Ue(["px-4 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",i.value||a.value?"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[i.value||a.value?(E(),B("svg",yt,[...y[5]||(y[5]=[v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(E(),B("svg",wt,[...y[6]||(y[6]=[v("path",{d:"M8 5v14l11-7z"},null,-1)])])),Pe(" "+I(i.value?"Loading...":a.value?"Running...":K(t)("tools.code-playground.common.run")),1)],10,mt)]),v("div",bt,[We(He,{modelValue:s.value,"onUpdate:modelValue":y[1]||(y[1]=k=>s.value=k),language:"zig",theme:"vs-dark",height:"100%",minimap:!1},null,8,["modelValue"])])]),v("div",xt,[v("div",vt,[v("div",Ut,[v("span",kt,I(K(t)("tools.code-playground.common.output")),1),u.value?(E(),B("span",Bt,I(u.value)+"ms",1)):ae("",!0)]),v("button",{onClick:ee,class:"text-xs text-slate-500 hover:text-white transition-colors"},I(K(t)("tools.code-playground.common.clear")),1)]),i.value?(E(),B("div",Et,[v("div",At,[y[7]||(y[7]=v("div",{class:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1)),v("div",Dt,I(l.value),1)])])):(E(),B("div",Tt,[(E(!0),B(oe,null,le(n.value,(k,T)=>(E(),B("div",{key:T,class:Ue(["flex items-start gap-2",se(k.type)])},[k.type==="error"?(E(),B("span",Lt,"✗")):(E(),B("span",Nt,"›")),v("span",Rt,I(k.message),1)],2))),128)),n.value.length===0&&!i.value&&!a.value?(E(),B("div",zt,' Click "Run" to execute Zig code... ')):ae("",!0)]))])])}}};export{Mt as default};
