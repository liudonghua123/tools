import{_ as D,u as I,r as d,o as W,c as a,j as l,d as t,g as _,t as u,e as h,h as U,s as H,F as k,f as M,n as B,i as O,b as P}from"./index-BL10sSGN.js";import q from"./MonacoEditor-CY7Kln0m.js";import{f as G,a as F}from"./ExampleLoader-C0CuCz3g.js";import"./monaco-editor-DrHUTMTD.js";const J={class:"flex flex-col md:flex-row h-full"},K={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col border-b md:border-b-0 md:border-r border-slate-700"},Q={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-800/50"},X={class:"flex items-center gap-4"},Y={class:"flex items-center gap-2"},Z={key:0,class:"text-xs px-2 py-0.5 bg-emerald-600 text-white rounded-full"},ee={key:1,class:"text-xs px-2 py-0.5 bg-slate-600 text-slate-300 rounded-full"},te={class:"relative group"},se=["label"],oe=["value"],ae=["disabled"],le={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},re={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},ne={class:"flex-1 min-h-0"},ie={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-slate-900"},ue={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},de={class:"flex items-center gap-3"},ce={class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},pe={key:0,class:"text-xs text-slate-500"},me={key:0,class:"flex-1 flex items-center justify-center"},ve={class:"text-center space-y-4"},ye={class:"text-slate-400"},fe={key:1,class:"flex-1 overflow-y-auto p-4 font-mono text-sm space-y-1"},xe={key:0,class:"text-red-400"},be={key:1,class:"text-green-400"},he={class:"whitespace-pre-wrap"},we={key:0,class:"text-slate-500 italic"},ge={__name:"RubyRunner",emits:["output","error","ready"],setup(_e,{emit:L}){const{t:c}=I(),R=L,y=d(""),C=d(null),f=d(""),i=d([]),n=d(!1),g=d(!1),p=d(""),x=d(null);let m=null;const z=async()=>{try{const s=await G("ruby");if(C.value=s,s.chapters&&s.chapters.length>0&&s.chapters[0].examples.length>0){const e=s.chapters[0].examples[0];f.value=e.path,y.value=await F("ruby",e.path)}}catch(s){console.error("Failed to load Ruby manifest:",s)}},$=async()=>{if(m)return m;if(window.rubyVM)return m=window.rubyVM,g.value=!0,m;n.value=!0,p.value=c("tools.code-playground.ruby.loading");try{const s="/tools/",e=`${s.endsWith("/")?s:s+"/"}ruby-wasm/`;if(await new Promise((j,A)=>{if(window["ruby-wasm-wasi"])return j();const w=document.createElement("script");w.src=`${e}browser.umd.js`,w.onload=j,w.onerror=()=>A(new Error("Failed to load browser.umd.js")),document.head.appendChild(w)}),!window["ruby-wasm-wasi"])throw new Error('Ruby WASM script loaded but window["ruby-wasm-wasi"] not found');p.value="Initializing Ruby environment...";const{DefaultRubyVM:v}=window["ruby-wasm-wasi"],o=await fetch(`${e}ruby+stdlib.wasm`);if(!o.ok)throw new Error(`Failed to fetch ruby+stdlib.wasm: ${o.statusText}`);const r=await o.arrayBuffer(),b=await WebAssembly.compile(r),{vm:E}=await v(b);return m=E,window.rubyVM=E,g.value=!0,R("ready"),m}catch(s){throw i.value.push({type:"error",message:`Failed to load Ruby: ${s.message}`}),console.error(s),s}finally{n.value=!1,p.value=""}},N=async()=>{if(f.value){V();try{n.value=!0,p.value="Loading example...",y.value=await F("ruby",f.value)}catch(s){i.value.push({type:"error",message:`Failed to load example: ${s.message}`})}finally{n.value=!1,p.value=""}}},S=async()=>{i.value=[],x.value=null;try{const s=console.log,e=console.error;console.log=(...r)=>{s(...r);const b=r.join(" ");i.value.push({type:"log",message:b})},console.error=(...r)=>{e(...r);const b=r.join(" ");i.value.push({type:"error",message:b})};const v=performance.now();try{(await $()).eval(y.value.replace(/\r/g,""))}catch(r){i.value.push({type:"error",message:r.toString()})}finally{console.log=s,console.error=e}const o=performance.now();x.value=(o-v).toFixed(2)}catch(s){i.value.push({type:"error",message:s.message}),R("error",s)}},V=()=>{i.value=[],x.value=null},T=s=>s==="error"?"text-red-400":"text-blue-400";return W(()=>{z()}),(s,e)=>{var v;return l(),a("div",J,[t("div",K,[t("div",Q,[t("div",X,[t("div",Y,[e[2]||(e[2]=t("svg",{class:"w-5 h-5 text-red-500",viewBox:"0 0 128 128",fill:"currentColor"},[t("path",{d:"M3.802 99.828c.656 23.608 17.689 23.959 24.945 24.167l-16.759-39.14-8.186 14.973z"}),t("path",{d:"M4.981 65.131l6.987 19.821 30.365-6.812L77 45.922l9.783-31.075L71.38 3.969l-26.19 9.802c-8.252 7.675-24.263 22.86-24.84 23.146-.573.291-10.575 19.195-15.369 28.214z"})],-1)),e[3]||(e[3]=t("span",{class:"font-bold text-white"},"Ruby 3.4",-1)),g.value?(l(),a("span",Z,u(h(c)("tools.code-playground.common.ready")),1)):n.value?_("",!0):(l(),a("span",ee,u(h(c)("tools.code-playground.common.not_loaded","Not loaded")),1))]),t("div",te,[U(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),onChange:N,class:"appearance-none bg-slate-700/50 border border-slate-600 text-slate-200 text-xs rounded px-2 pr-6 py-1 hover:border-slate-500 focus:outline-none focus:ring-1 focus:ring-red-500 transition-all cursor-pointer"},[(l(!0),a(k,null,M((v=C.value)==null?void 0:v.chapters,o=>(l(),a("optgroup",{key:o.title,label:o.title},[(l(!0),a(k,null,M(o.examples,r=>(l(),a("option",{key:r.path,value:r.path},u(r.name),9,oe))),128))],8,se))),128))],544),[[H,f.value]]),e[4]||(e[4]=t("div",{class:"absolute inset-y-0 right-1.5 flex items-center pointer-events-none text-slate-400"},[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),t("button",{onClick:S,disabled:n.value,class:B(["px-4 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",n.value?"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[n.value?(l(),a("svg",le,[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),a("svg",re,[...e[6]||(e[6]=[t("path",{d:"M8 5v14l11-7z"},null,-1)])])),O(" "+u(n.value?"Loading...":h(c)("tools.code-playground.common.run")),1)],10,ae)]),t("div",ne,[P(q,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o),language:"ruby",height:"100%",minimap:!1},null,8,["modelValue"])])]),t("div",ie,[t("div",ue,[t("div",de,[t("span",ce,u(h(c)("tools.code-playground.common.output")),1),x.value?(l(),a("span",pe,u(x.value)+"ms",1)):_("",!0)]),t("button",{onClick:V,class:"text-xs text-slate-500 hover:text-white transition-colors"},u(h(c)("tools.code-playground.common.clear")),1)]),n.value?(l(),a("div",me,[t("div",ve,[e[7]||(e[7]=t("div",{class:"w-12 h-12 border-4 border-rose-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1)),t("div",ye,u(p.value),1),e[8]||(e[8]=t("div",{class:"text-xs text-slate-500"},"Initializing Ruby WASM...",-1))])])):(l(),a("div",fe,[(l(!0),a(k,null,M(i.value,(o,r)=>(l(),a("div",{key:r,class:B(["flex items-start gap-2",T(o.type)])},[o.type==="error"?(l(),a("span",xe,"✗")):(l(),a("span",be,"›")),t("span",he,u(o.message),1)],2))),128)),i.value.length===0&&!n.value?(l(),a("div",we,' Click "Run" to execute Ruby code... ')):_("",!0)]))])])}}},Ve=D(ge,[["__scopeId","data-v-90857604"]]);export{Ve as default};
