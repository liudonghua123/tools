import{_ as D}from"./monaco-editor-DrHUTMTD.js";import{r as u,o as I,m as N,c as a,j as o,_ as O,u as S,a as U,d as t,g as k,t as d,e as w,h as H,s as A,F as R,f as C,n as z,i as q,b as W}from"./index-Bd2RUhbK.js";import G from"./MonacoEditor-jAbR2_xV.js";import{f as J,a as F}from"./ExampleLoader-C0CuCz3g.js";const K={__name:"PlotCanvas",props:{image:{type:Object,required:!0}},setup(E){const m=E,p=u(null),_=()=>{const r=p.value;if(!r||!m.image)return;r.width=m.image.width,r.height=m.image.height,r.getContext("2d").drawImage(m.image,0,0)};return I(()=>{_()}),N(()=>m.image,()=>{_()}),(r,v)=>(o(),a("canvas",{ref_key:"canvasRef",ref:p,class:"max-w-full h-auto mx-auto"},null,512))}},Q={class:"flex flex-col md:flex-row h-full"},X={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col border-b md:border-b-0 md:border-r border-slate-700"},Y={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-800/50"},Z={class:"flex items-center gap-4"},ee={class:"flex items-center gap-2"},te={key:0,class:"text-xs px-2 py-0.5 bg-emerald-600 text-white rounded-full"},se={key:1,class:"text-xs px-2 py-0.5 bg-slate-600 text-slate-300 rounded-full"},ae={class:"relative group"},oe=["label"],le=["value"],re=["disabled"],ne={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ie={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},ue={class:"flex-1 min-h-0"},ce={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-slate-900"},de={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},pe={class:"flex items-center gap-3"},me={class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},ve={key:0,class:"text-xs text-slate-500"},he={key:0,class:"flex-1 flex items-center justify-center"},xe={class:"text-center space-y-4"},fe={class:"text-slate-400"},ge={key:1,class:"flex-1 overflow-y-auto p-4 font-mono text-sm space-y-4"},_e={class:"space-y-1"},ye={key:0,class:"text-red-400"},be={key:1,class:"text-emerald-400"},we={class:"whitespace-pre-wrap"},ke={key:0,class:"text-slate-500 italic"},Re={key:0,class:"border-t border-slate-700 pt-4"},Ce={__name:"RRunner",emits:["output","error","ready"],setup(E,{emit:m}){const{t:p}=S(),_=m,r=u(""),v=u(""),M=u(null),c=u([]),h=u([]),i=u(!1),V=u(!1),y=u(""),b=u(null);let x=null;const L=async()=>{try{const s=await J("r");if(M.value=s,s.chapters&&s.chapters.length>0&&s.chapters[0].examples.length>0){const e=s.chapters[0].examples[0];v.value=e.path,r.value=await F("r",e.path)}}catch(s){console.error("Failed to load R manifest:",s)}},j=async()=>{i.value=!0,y.value="Initializing WebR...";try{const s="/tools/",e=`${s.endsWith("/")?s:s+"/"}webr/`,{WebR:f}=await D(async()=>{const{WebR:l}=await import(`${e}webr.js`);return{WebR:l}},[]);x=new f,await x.init(),V.value=!0,_("ready")}catch(s){c.value.push({type:"error",message:`Failed to load WebR: ${s.message}`}),console.error(s)}finally{i.value=!1,y.value=""}},T=async()=>{c.value=[],h.value=[],b.value=null,x||await j();try{const s=performance.now(),e=await new x.Shelter;try{console.log(`Running R code: ${r.value}`);const l=r.value.trim().replace(/\r/g,""),n=await e.captureR(l);n.output.forEach(g=>{g.type==="stdout"?c.value.push({type:"log",message:g.data}):g.type==="stderr"&&c.value.push({type:"error",message:g.data})}),n.images&&n.images.length>0&&n.images.forEach(g=>{h.value.push(g)})}finally{e.purge()}const f=performance.now();b.value=(f-s).toFixed(2)}catch(s){console.error("R Execution Error:",s),c.value.push({type:"error",message:s.message||String(s)}),_("error",s)}},$=async()=>{if(v.value){B();try{i.value=!0,y.value="Loading example...",r.value=await F("r",v.value)}catch(s){c.value.push({type:"error",message:`Failed to load example: ${s.message}`})}finally{i.value=!1,y.value=""}}},B=()=>{c.value=[],h.value=[],b.value=null},P=s=>s==="error"?"text-red-400":"text-emerald-400";return I(()=>{j(),L()}),U(()=>{x&&x.destroy()}),(s,e)=>{var f;return o(),a("div",Q,[t("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[e[2]||(e[2]=t("svg",{class:"w-5 h-5 text-blue-400",viewBox:"0 0 128 128",fill:"currentColor"},[t("path",{d:"M68.52 1.05C33.19 1.05 4.54 22.14 4.54 48.15c0 19.34 1.51 30.55 2.06 32.74v.14c-1.72 2.75-2.06 6.18-2.06 10.3 0 8.07 10.99 14.63 24.51 14.63 12.02 0 22.02-5.15 24-12.02l4.81.34s6.18 10.99 15.45 23.35h32.11L85.17 93.31l1.37-.34h4.12c18.54 0 32.74-20.26 32.74-42.92 0-27.47-23.7-49-54.88-49zm-.52 15.63c22.84 0 41.37 14.42 41.37 32.2 0 17.78-18.52 32.2-41.37 32.2s-28.32-14.42-28.32-32.2c0-17.78 5.48-32.2 28.32-32.2zm10.3 22.84h-10.3v3.6h9.1c2.23 0 5.4 1.44 5.4 5.14 0 3.7-3.17 5.14-5.4 5.14h-9.1v-6.35h-7.71v23.2h7.71v-9.35H77c3.38 0 8.64.43 13.1-4.32 4.46-4.75 4.46-13.06-.58-17.06z"})],-1)),e[3]||(e[3]=t("span",{class:"font-bold text-white"},"R",-1)),V.value?(o(),a("span",te,d(w(p)("tools.code-playground.common.ready")),1)):i.value?k("",!0):(o(),a("span",se,d(w(p)("tools.code-playground.common.not_loaded")),1))]),t("div",ae,[H(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),onChange:$,class:"appearance-none px-2 pr-6 py-1 bg-slate-700 border border-slate-600 rounded text-slate-200 text-xs focus:outline-none focus:border-blue-500 transition-all cursor-pointer"},[(o(!0),a(R,null,C((f=M.value)==null?void 0:f.chapters,l=>(o(),a("optgroup",{key:l.title,label:l.title},[(o(!0),a(R,null,C(l.examples,n=>(o(),a("option",{key:n.path,value:n.path},d(n.name),9,le))),128))],8,oe))),128))],544),[[A,v.value]]),e[4]||(e[4]=t("div",{class:"absolute inset-y-0 right-1.5 flex items-center pointer-events-none text-slate-400"},[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),t("button",{onClick:T,disabled:i.value,class:z(["px-4 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",i.value?"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[i.value?(o(),a("svg",ne,[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(o(),a("svg",ie,[...e[6]||(e[6]=[t("path",{d:"M8 5v14l11-7z"},null,-1)])])),q(" "+d(i.value?"Loading...":w(p)("tools.code-playground.common.run")),1)],10,re)]),t("div",ue,[W(G,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),language:"r",height:"100%",minimap:!1},null,8,["modelValue"])])]),t("div",ce,[t("div",de,[t("div",pe,[t("span",me,d(w(p)("tools.code-playground.common.output")),1),b.value?(o(),a("span",ve,d(b.value)+"ms",1)):k("",!0)]),t("button",{onClick:B,class:"text-xs text-slate-500 hover:text-white transition-colors"},d(w(p)("tools.code-playground.common.clear")),1)]),i.value?(o(),a("div",he,[t("div",xe,[e[7]||(e[7]=t("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1)),t("div",fe,d(y.value),1),e[8]||(e[8]=t("div",{class:"text-xs text-slate-500"},"Initializing WebR environment...",-1))])])):(o(),a("div",ge,[t("div",_e,[(o(!0),a(R,null,C(c.value,(l,n)=>(o(),a("div",{key:n,class:z(["flex items-start gap-2",P(l.type)])},[l.type==="error"?(o(),a("span",ye,"✗")):(o(),a("span",be,"›")),t("span",we,d(l.message),1)],2))),128)),c.value.length===0&&h.value.length===0&&!i.value?(o(),a("div",ke,' Click "Run" to execute R code... ')):k("",!0)]),h.value.length>0?(o(),a("div",Re,[e[9]||(e[9]=t("h3",{class:"text-xs font-bold text-slate-400 mb-2 uppercase"},"Plots",-1)),(o(!0),a(R,null,C(h.value,(l,n)=>(o(),a("div",{key:n,class:"bg-white rounded p-1 mb-2"},[W(K,{image:l},null,8,["image"])]))),128))])):k("",!0)]))])])}}},Be=O(Ce,[["__scopeId","data-v-cefb2dac"]]);export{Be as default};
